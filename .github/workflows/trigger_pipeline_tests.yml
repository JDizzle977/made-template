name: CI Tests

on:
  push:
    branches:
      - main
    paths:
      - project/**

  workflow_dispatch:
    
jobs:
  test:
    runs-on: ubuntu-latest

    steps: 
      - name: Check out Code 
        uses: actions/checkout@v4
        with:
          path: main

      - name: Python Setup
        uses: actions/setup-python@v4
        with: 
          python-version: 3.9

      - name: Install dependencies
        run: | 
              python -m pip install --upgrade pip
              pip install pytest pandas requests beautifulsoup4 selenium openpyxl

      - name: Setup Ubuntu Chromedriver
          uses: nanasess/setup-chromedriver@v2
          with:
            # Optional: do not specify to match Chrome's version
            # chromedriver-version: '88.0.4324.96'
            # Optional: if your chrome binary name is different
            chromeapp: chrome
          run: |
            export DISPLAY=:99
            chromedriver --url-base=/wd/hub &
            sudo Xvfb -ac :99 -screen 0 1280x1024x24 > /dev/null 2>&1 & # optional

      - name: Make Files executable
        run: |
              chmod +x main/project/tests.sh 
              chmod +x main/project/chromedriver.exe

      - name: Run Tests
        run: main/project/tests.sh 
